(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoSpaceApp"]=e():t["CoSpaceApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({1173:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){}initialize(){}destroy(){}}e.CoSystem=a},"1e86":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.DATA_PARSE=3501,a.DATA_QUEUE_PARSE=3502,a.THREAD_INIT=3601,a.INIT_COMMON_MODULE=3621,a.THREAD_ACQUIRE_DATA=3631,a.THREAD_TRANSMIT_DATA=3632,a.INIT_TASK=3701,a.INIT_PARAM=3801,e.ThreadCMD=a},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var a=window.document.currentScript,i=s("8875");a=i(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:i});var r=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(s.p=r[1])}},"1f9e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.PARSE="CTM_PARSE",a.LOAD_AND_PARSE="CTM_LOAD_AND_PARSE",e.CTMTaskCMD=a},2033:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("698b");class i{constructor(){this.dataPhaseFlag=a.DataPhaseFlag.PHASE_NONE,this.dataUnitUUID=0,this.listUUID=0}receiveDataUnit(t,e){}}e.DataReceiverBase=i},2356:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){this.taskclass=-1,this.srcuid=-1,this.dataIndex=-1,this.streams=null,this.sendStatus=-1,this.wfst=0}buildThis(t){}reset(){}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.m_unitList[e],t.dataIndex=e,a.m_unitFlagList[e]=a.s_FLAG_BUSY):(t=new a,a.m_unitList.push(t),a.m_unitFlagList.push(a.s_FLAG_BUSY),t.dataIndex=a.m_unitListLen,a.m_unitListLen++),t}static Contains(t){if(null!=t){let e=t.dataIndex;if(e>=0&&e<a.m_unitListLen)return a.m_unitList[e]==t}return!1}static Restore(t){if(a.Contains(t)){let e=t.dataIndex;a.m_unitFlagList[e]==a.s_FLAG_BUSY&&(a.m_freeIdList.push(e),a.m_unitFlagList[e]=a.s_FLAG_FREE,t.sendStatus=-1,t.reset())}}static RestoreByUid(t){t>=0&&a.m_unitFlagList[t]==a.s_FLAG_BUSY&&(a.m_freeIdList.push(t),a.m_unitFlagList[t]=a.s_FLAG_FREE,a.m_unitList[t].reset())}}a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.m_unitFlagList=[],a.m_unitListLen=0,a.m_unitList=[],a.m_freeIdList=[],e.ThreadSendData=a},2931:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("9cc2");class i{constructor(){this.m_receivers=[],this.m_flag=!0}testReset(){this.m_flag=!0}addReceiver(t){this.m_receivers.push(t)}removeReceiver(t){let e=this.m_receivers;for(let s=0,a=e.length;s<a;++s)if(t==e[s]){e.splice(s,1);break}}testUnitForce(t){if(this.m_flag){if(this.unit.isCpuPhase()){let t=this.m_receivers;for(let e=0,s=t.length;e<s;++e){const s=t[e];s.dataUnitUUID>0&&s.listUUID>0&&s.receiveDataUnit(this.unit,1)}return this.m_flag=!1,!0}return!1}return!0}testUnit(){if(this.m_flag){if(this.unit.isCpuPhase()){let t=this.m_receivers;for(let e=0,s=t.length;e<s;++e){const s=t[e];s.dataUnitUUID>0&&s.listUUID>0&&s.receiveDataUnit(this.unit,1)}return this.m_flag=!1,!0}return!1}return!0}destroy(t,e){let s=this.m_receivers;for(let a=0,i=s.length;a<i;++a){const e=s[a];t.removeItem(e)}e.delete(this.uuid),this.uuid=0,this.m_receivers=null}}class r{constructor(){this.m_nodeMap=new Map,this.m_nodes=[],this.m_receiverPool=new a.ListPool,this.m_receiversTotal=0}testUnitForce(t,e){if(null!=t){let s=this.m_nodeMap.get(t.getUUID());if(null!=s)return s.testUnitForce(e),s.testUnit()}return!1}testUnit(t){if(null!=t){let e=this.m_nodeMap.get(t.getUUID());if(null!=e)return e.testUnit()}return!1}addReceiver(t,e){if(null!=e&&this.m_receiverPool.hasnotItem(t)){let s;this.m_nodeMap.has(e.getUUID())?s=this.m_nodeMap.get(e.getUUID()):(s=new i,s.unit=e,s.uuid=e.getUUID(),this.m_nodes.push(s),this.m_nodeMap.set(e.getUUID(),s)),t.dataUnitUUID=e.getUUID();let a=t.listUUID;if(this.m_receiverPool.addItem(t),a==t.listUUID)throw"ReceiverSchedule::addReceiver() is the illegal operation !!!(listUUID("+a+"), receiver.listUUID("+t.listUUID+"))";s.addReceiver(t),this.m_receiversTotal++}}removeReceiver(t){if(t.dataUnitUUID>0&&t.listUUID>0&&this.m_receiverPool.hasItem(t)){let e=this.m_nodeMap.get(t.dataUnitUUID);e.removeReceiver(t),this.m_receiverPool.removeItem(t),this.m_receiversTotal--}t.dataUnitUUID=0,t.listUUID=0}getReceiversTotal(){return this.m_receiversTotal}run(){if(this.m_receiversTotal>0){let t,e,s=this.m_nodes;for(let a=0,i=s.length;a<i;++a)e=s[a],t=e.testUnit(),t&&(this.m_receiversTotal--,s.splice(a,1),e.destroy(this.m_receiverPool,this.m_nodeMap),a--,i--)}}destroy(){}}e.ReceiverSchedule=r},"2a59":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee"),i=s("7de1"),r=s("8eb0"),l=s("aeff"),n=s("73f9"),o=s("eed9"),h=s("31e1"),d=s("8f7d");class u extends i.ResourceSchedule{constructor(){super(),this.m_waitingUnits=[]}addUrlToTask(t){let e=t.url;switch(t.data.dataFormat){case a.DataFormat.CTM:this.m_ctmListener.addUrlToTask(e);break;case a.DataFormat.Draco:this.m_dracoListener.addUrlToTask(e);break;case a.DataFormat.OBJ:this.m_objListener.addUrlToTask(e);break;case a.DataFormat.FBX:this.m_fbxListener.addUrlToTask(e);break;default:break}}createDataUnit(t,e,s=!1){l.DataUnitLock.lockStatus=207;let a=new l.GeometryDataUnit;return a.lossTime=Date.now(),a.immediate=s,a.data=new l.GeometryDataContainer,a.data.dataFormat=e,a.url=t,this.isInitialized()?this.addUrlToTask(a):this.m_waitingUnits.push(a),a}initTask(t,e,s,a){for(let l=0;l<a.length;++l){const i=a[l];switch(i.name){case r.ModuleNS.ctmParser:this.m_ctmListener=new n.CTMParserListerner(t,e,i,s);break;case r.ModuleNS.dracoParser:this.m_dracoListener=new o.DracoParserListerner(t,e,i,s);break;case r.ModuleNS.objParser:this.m_objListener=new h.OBJParserListerner(t,e,i,s);break;case r.ModuleNS.fbxFastParser:this.m_fbxListener=new d.FBXParserListerner(t,e,i,s);break;default:break}}let i=this.m_waitingUnits;for(let r=0;r<i.length;r++)this.addUrlToTask(i[r]);this.m_waitingUnits=[]}destroy(){super.destroy(),this.m_waitingUnits=[],null!=this.m_ctmListener&&(this.m_ctmListener.destroy(),this.m_ctmListener=null),null!=this.m_objListener&&(this.m_objListener.destroy(),this.m_objListener=null),null!=this.m_fbxListener&&(this.m_fbxListener.destroy(),this.m_fbxListener=null),null!=this.m_dracoListener&&(this.m_dracoListener.destroy(),this.m_dracoListener=null)}}e.GeometryResourceSchedule=u},"2e55":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.PARSE="DRACO_PARSE",a.ENCODE="DRACO_ENCODE",a.THREAD_ACQUIRE_DATA="DRACO_THREAD_ACQUIRE_DATA",a.THREAD_TRANSMIT_DATA="DRACO_THREAD_TRANSMIT_DATA",e.DracoTaskCMD=a},"31e1":function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("5b39"),r=s("aeff"),l=s("ceac"),n=a(s("3bda"));class o{constructor(t,e,s,a){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new l.OBJParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new i.HttpFileLoader).load(t,(t,e)=>{n.default.ShowLogOnce("正在解析OBJ数据..."),this.m_parseTask.addBinaryData(t,e)},(t,e)=>{let s=Math.round(100*t);n.default.ShowLogOnce("obj file loading "+s+"%")},(t,e)=>{this.objParseFinish([{vertices:null,uvsList:null,normals:null,indices:null}],e)})}}objParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.dataFormat=r.DataFormat.OBJ,s.data.models=t,r.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.OBJParserListerner=o},3844:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},3964:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t){this.m_dataEnabled=!1,this.param=null,this.m_taskclass=t}getTaskClass(){return this.m_taskclass}isDataEnabled(){return this.m_dataEnabled}isTransmission(){return this.m_dataEnabled&&null!=this.param}disable(){this.m_dataEnabled=!1}setData(t){}acquireTrigger(){}getData(){throw Error("illegal operation !!!")}getTransfers(){return null}}e.TaskDataRouter=a},"3a1d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("fce7"),i=s("7566"),r=s("2356"),l=s("7ebf"),n=s("c917"),o=s("d2d9"),h=s("42a2"),d=s("85f5"),u=s("63fb");class m{constructor(){this.m_initBoo=!0,this.m_teDelay=3e3,this.m_teTime=0,this.m_maxThreadsTotal=0,this.m_thrSupportFlag=-1,this.m_codeBlob=null,this.m_commonModuleUrls=[],this.m_threads=[],this.m_threadsTotal=0,this.m_threadEnabled=!0,this.m_thrIdexSDList=[],this.m_thrIndexList=[],this.m_codeStrList=[],this.m_dataPool=new i.ThrDataPool,this.m_graphJsonStr="",this.m_autoSendData=!1,this.m_currNewThr=null;let t=a.ThreadConfigure.MAX_TASKS_TOTAL;this.m_taskPool=new h.ThreadTaskPool(t),this.m_descList=new Array(t),this.m_descList.fill(null),this.m_tdrManager=new d.TDRManager(t),this.m_taskReg=new u.TaskRegister,this.m_teTime=Date.now()}setParams(t,e=3e3){this.m_autoSendData=t,this.m_teDelay=e}hasRouterByTaskClass(t){return this.m_tdrManager.hasRouterByTaskClass(t)}setTaskDataRouter(t){this.m_tdrManager.setRouter(t)}bindTask(t,e=-1){if(null!=t){let s=t.attach(this.m_taskPool);if(s){let s=null;if(e>=0&&e<this.m_maxThreadsTotal){for(;;){if(!(e>=this.m_threadsTotal))break;this.createThread()}s=this.m_threads[e].localDataPool}let a=t.dependency,i=null;null!=a&&(a.isJSFile()?i=this.initTaskByURL(a.threadCodeFileURL,-1):a.isDependency()?i=this.initTaskByDependency(a.dependencyUniqueName,a.moduleName):a.isCodeString()&&(i=this.initTaskByCodeStr(a.threadCodeString,a.moduleName))),t.setDataPool(this.m_dataPool,s),t.setTaskInfo(i)}}}sendDataToThreadAt(t,e){if(t>=0&&t<this.m_maxThreadsTotal){if(t>=this.m_threadsTotal)for(;;){if(!(t>=this.m_threadsTotal))break;this.createThread()}null!=e&&e.sendStatus<0&&(this.m_threads[t].isFree()?(e.sendStatus=0,this.m_threads[t].sendDataTo(e)):this.m_threads[t].localDataPool.addData(e))}else this.m_thrIdexSDList.push(e),this.m_thrIndexList.push(t)}hasTaskData(){return this.m_dataPool.isEnabled()}getThrDataPool(){return this.m_dataPool}run(){let t=!1;if(this.getThreadEnabled()){this.m_tdrManager.run();let e=0;if(this.m_dataPool.isEnabled())for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].isFree()?this.m_dataPool.sendDataTo(this.m_threads[t]):this.m_dataPool.isEnabled()&&e++;else for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].sendPoolDataToThread()||this.m_threads[t].hasDataToThread()&&e++;if(e+=this.m_dataPool.isEnabled()?1:0,e>0)this.createThread();else{e=0;for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].isFree()&&e++;this.m_teDelay>0&&(t=e>=this.m_threadsTotal,t||(this.m_teTime=Date.now()))}}if(t&&this.m_threadsTotal>0){let t=Date.now()-this.m_teTime;if(t>this.m_teDelay){this.m_teTime=Date.now();let t=this.m_threads[this.m_threadsTotal-1];t.isFree()&&(this.m_threads.pop(),this.m_threadsTotal--,t.destroy())}}}createThread(){if(null!=this.m_currNewThr&&(this.m_currNewThr.isEnabled()||this.m_currNewThr.isDestroyed())&&(this.m_currNewThr=null),null==this.m_currNewThr&&this.m_threadsTotal<this.m_maxThreadsTotal){let t=new l.ThreadBase(this.m_tdrManager,this.m_taskPool,this.m_graphJsonStr);this.m_currNewThr=t,t.autoSendData=this.m_autoSendData,t.globalDataPool=this.m_dataPool,t.initialize(this.m_codeBlob),this.m_threads.push(t),this.m_threadsTotal++,this.m_tdrManager.setThreads(this.m_threads);for(let a=0,i=this.m_descList.length;a<i;++a)t.initModuleByTaskDescriptor(this.m_descList[a]);t.initModules(this.m_commonModuleUrls);for(let a=0;a<this.m_codeStrList.length;++a)t.initModuleByCodeString(this.m_codeStrList[a]);this.m_threadsTotal>=this.m_maxThreadsTotal&&(this.m_commonModuleUrls=[],this.m_codeStrList=[]);let e=this.m_thrIdexSDList.slice(0),s=this.m_thrIndexList.slice(0);this.m_thrIdexSDList=[],this.m_thrIndexList=[];for(let a=0;a<e.length;++a)this.sendDataToThreadAt(s[a],e[a])}}addDataWithParam(t,e=null,s=null){let a=r.ThreadSendData.Create();a.taskCmd=t,a.streams=e,a.descriptor=s,this.addData(a)}addData(t){null!=t&&t.srcuid>=0&&this.m_dataPool.addData(t)}getAFreeThread(){for(let t=0;t<this.m_threadsTotal;++t)if(this.m_threads[t].isFree())return this.m_threads[t];return null}getThreadsTotal(){return this.m_threadsTotal}getMaxThreadsTotal(){return this.m_maxThreadsTotal}setThreadEnabled(t){this.m_thrSupportFlag>0&&(this.m_thrSupportFlag=t?2:1),this.m_threadEnabled=t}getThreadEnabled(){return this.m_threadEnabled}isSupported(){if(this.m_thrSupportFlag>0)return 2==this.m_thrSupportFlag;let t="undefined"!==typeof Worker&&"undefined"!==typeof Blob;return this.m_thrSupportFlag=t?2:1,this.m_threadEnabled=t,t}initTaskByURL(t,e,s=""){if(""!=t){let e=this.m_taskReg.getTaskClassByKeyuns(t),a=e>=0?this.m_descList[e]:null;return null==a&&(a=new n.TaskDescriptor(o.ThreadCodeSrcType.JS_FILE_CODE,t,s),this.m_taskReg.buildTaskInfo(a),e=a.info.taskClass,this.m_descList[e]=a,this.initModuleByTaskDescriptor(a)),a.info}return null}initTaskByDependency(t,e=""){if(""!=t){let s=this.m_taskReg.getTaskClassByKeyuns(t),a=s>=0?this.m_descList[s]:null;return null==a&&(a=new n.TaskDescriptor(o.ThreadCodeSrcType.DEPENDENCY,t,e),this.m_taskReg.buildTaskInfo(a),s=a.info.taskClass,this.m_descList[s]=a,this.initModuleByTaskDescriptor(a)),a.info}return null}initTaskByCodeStr(t,e){if(""!=t){let s=this.m_taskReg.getTaskClassByKeyuns(e),a=s>=0?this.m_descList[s]:null;return null==a&&(a=new n.TaskDescriptor(o.ThreadCodeSrcType.STRING_CODE,t,e),this.m_taskReg.buildTaskInfo(a),s=a.info.taskClass,this.m_descList[s]=a,this.initModuleByTaskDescriptor(a)),a.info}return null}initModuleByTaskDescriptor(t){for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModuleByTaskDescriptor(t)}initModules(t){if(null!=t&&t.length>0){for(let e=0;e<t.length;++e){if(""==t[e])throw Error("moduleUrls["+e+'] == ""');this.m_commonModuleUrls.push(t[e])}for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModules(t)}}initModuleByCodeString(t){if(t.length>8){this.m_threadsTotal<this.m_maxThreadsTotal&&this.m_codeStrList.push(t);for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModuleByCodeString(t)}}destroy(){if(null!=this.m_tdrManager){for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].destroy();this.m_threads=[],this.m_tdrManager.destroy(),this.m_tdrManager=null,this.m_threadsTotal=0}}setDependencyGraphJsonString(t){this.m_graphJsonStr=t}initialize(t,e,s=""){if(this.m_initBoo){if(this.getThreadEnabled()&&this.isSupported()){if(""==e)throw Error('coreCodeUrl == "" !!!');e=this.getUrl(e);let a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=()=>{if(a.status<=206){let e=""==s?new Blob([a.responseText]):new Blob([s+a.responseText]);this.initThread(t,e)}},a.onerror=t=>{},a.send(null)}this.m_initBoo=!1}}initThread(t,e){t<1&&(t=1),this.m_codeBlob=e,this.m_maxThreadsTotal=t}getUrl(t){let e=t.indexOf("http://");if(e<0&&(e=t.indexOf("https://")),e>=0)return t;let s=window.location.href,a=s.slice(0,s.lastIndexOf("/")+1);return t=a+t,t}}e.ThreadSchedule=m},"3b80":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("d2d9");class i{constructor(){this.moduleName="",this.threadCodeString="",this.threadCodeFileURL="",this.dependencyUniqueName="",this.threadCodeSrcType=a.ThreadCodeSrcType.JS_FILE_CODE}isCodeString(){return this.threadCodeSrcType==a.ThreadCodeSrcType.STRING_CODE}isJSFile(){return this.threadCodeSrcType==a.ThreadCodeSrcType.JS_FILE_CODE}isDependency(){return this.threadCodeSrcType==a.ThreadCodeSrcType.DEPENDENCY}isCodeBlob(){return this.threadCodeSrcType==a.ThreadCodeSrcType.BLOB_CODE}clone(){let t=new i;return this.isCodeString()&&(t.threadCodeString=this.threadCodeString),this.isJSFile()&&(t.threadCodeFileURL=this.threadCodeFileURL),this.isDependency()&&(t.dependencyUniqueName=this.dependencyUniqueName),t.threadCodeSrcType=this.threadCodeSrcType,t}}e.TaskDependency=i;class r extends i{constructor(t){super(),this.threadCodeFileURL=t,this.threadCodeSrcType=a.ThreadCodeSrcType.JS_FILE_CODE}}e.TaskJSFileDependency=r;class l extends i{constructor(t){super(),this.dependencyUniqueName=t,this.threadCodeSrcType=a.ThreadCodeSrcType.DEPENDENCY}}e.TaskUniqueNameDependency=l;class n extends i{constructor(t,e){super(),this.threadCodeString=t,this.moduleName=e,this.threadCodeSrcType=a.ThreadCodeSrcType.STRING_CODE}}e.TaskCodeStringDependency=n},"3bda":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a567");class i{static SetDebugEnabled(t){i.s_debugEanbled=t}static SetXY(t,e){i.s_leftX=t,i.s_topY=e}static SetTextBgColor(t){i.s_textBGColor=a.RGBColorUtil.uint24RGBToCSSHeXRGBColor(t),null!=i.s_infoDiv&&(i.s_infoDiv.style.backgroundColor=this.s_textBGColor)}static SetTextColor(t){i.s_textColor=a.RGBColorUtil.uint24RGBToCSSHeXRGBColor(t),null!=i.s_infoDiv&&(i.s_infoDiv.style.color=this.s_textColor)}static SetTextBgEnabled(t){if(this.s_textBgEnabled=t,null!=i.s_infoDiv){let t=i.s_infoDiv;i.s_textBgEnabled?t.style.backgroundColor=this.s_textBGColor:t.style.backgroundColor=""}}static ShowLog(t){i.s_debugEanbled&&(i.s_logStr.length>0?i.s_logStr+="<br/>"+t:i.s_logStr=t,i.UpdateDivText())}static GetLog(){return i.s_logStr}static ShowLogOnce(t){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static ClearLog(t=""){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static UpdateDivText(){if(i.s_debugEanbled)if(null!=i.s_infoDiv)i.s_infoDiv.innerHTML=i.s_logStr;else{let t=document.createElement("div");t.style.color="";let e=t;e.width=128,e.height=64,i.s_textBgEnabled?e.style.backgroundColor=this.s_textBGColor:e.style.backgroundColor="",e.style.color=this.s_textColor,e.style.left=i.s_leftX+"px",e.style.top=i.s_topY+"px",e.style.zIndex="9999",e.style.position="absolute",document.body.appendChild(e),i.s_infoDiv=e,e.innerHTML=i.s_logStr}}static ShowAtTop(){null!=i.s_infoDiv&&(i.s_infoDiv.parentElement.removeChild(i.s_infoDiv),document.body.appendChild(i.s_infoDiv))}}i.s_logStr="",i.s_infoDiv=null,i.s_debugEanbled=!1,i.s_textBGColor="#aa0033",i.s_textColor="#000000",i.s_textBgEnabled=!0,i.s_leftX=0,i.s_topY=128,e.default=i},"42a2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t){this.m_total=0,this.m_total=t,this.m_taskList=new Array(t),this.m_taskList[0]=null,this.m_freeList=new Array(t);for(let e=1,s=t;e<s;++e)this.m_freeList[e]=e}getTaskByUid(t){return t<this.m_total&&t>0?this.m_taskList[t]:null}attachTask(t){if(t.getUid()<1&&this.m_freeList.length>0){let e=this.m_freeList.pop();return this.m_taskList[e]=t,e}return-1}detachTask(t){t.getUid()>0&&null!=this.m_taskList[t.getUid()]&&(this.m_taskList[t.getUid()]=null,this.m_freeList.push(t.getUid()))}}e.ThreadTaskPool=a},"58fc":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"5b39":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(t){this.crossOrigin=t}async load(t,e,s=null,a=null,i="blob",r=""){if(null==e)throw Error("onload == null !!!");const l=new FileReader;l.onload=s=>{e&&e(l.result,t)};const n=new XMLHttpRequest;n.open("GET",t,!0),""!=r&&n.setRequestHeader("Range",r),n.responseType=i,n.onload=s=>{if(n.status<=206)switch(i){case"arraybuffer":case"blob":l.readAsArrayBuffer(n.response);break;case"json":e&&e(n.response,t);break;case"text":e&&e(n.response,t);break;default:e&&e(n.response,t);break}else a&&a(n.status,t)},null!=s&&(n.onprogress=e=>{let a=0;if(e.total>0||e.lengthComputable)a=Math.min(1,e.loaded/e.total);else{let t=parseInt(n.getResponseHeader("content-length"));t>0&&(t*=4,a=Math.min(1,e.loaded/t))}s(a,t)}),null!=a&&(n.onerror=e=>{a(n.status,t)}),n.send(null)}}e.HttpFileLoader=a},"60cd":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t,e,s,a){this.status=0,this.taskclass=t,this.cmd=e,this.taskCmd=s,this.threadIndex=a}}e.TDRParam=a},"63fb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("d2d9");class i{constructor(){this.m_taskTotal=0,this.m_map=new Map}getTaskClassByKeyuns(t){return this.m_map.has(t)?this.m_map.get(t):-1}hasKeyuns(t){return this.m_map.has(t)}buildTaskInfo(t){let e=t.moduleName;switch(t.type){case a.ThreadCodeSrcType.JS_FILE_CODE:e=t.src;break;case a.ThreadCodeSrcType.DEPENDENCY:e=t.src;break;default:break}let s=-1;""!=e&&(this.m_map.has(e)?s=this.m_map.get(e):(s=this.m_taskTotal++,this.m_map.set(e,s))),t.info={taskClass:s,keyuns:e}}}e.TaskRegister=i},"698b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{static clearAllPhase(t=0){return a.PHASE_NONE}static addNetPhase(t){return a.PHASE_NET|t}static addCpuPhase(t){return a.PHASE_CPU|t}static addGpuPhase(t){return a.PHASE_GPU|t}static removeNetPhase(t){return~a.PHASE_NET&t}static removeCpuPhase(t){return~a.PHASE_CPU&t}static removeGpuPhase(t){return~a.PHASE_GPU&t}static isNonePhase(t){return a.PHASE_NONE==t}static isNetPhase(t){return(a.PHASE_NET&t)==a.PHASE_NET}static isCpuPhase(t){return(a.PHASE_CPU&t)==a.PHASE_CPU}static isGpuPhase(t){return(a.PHASE_GPU&t)==a.PHASE_GPU}}a.PHASE_NONE=0,a.PHASE_NET=4,a.PHASE_CPU=8,a.PHASE_GPU=16,e.DataPhaseFlag=a},"73f9":function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("5b39"),r=s("aeff"),l=s("7dbf"),n=a(s("3bda"));class o{constructor(t,e,s,a){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new l.CTMParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new i.HttpFileLoader).load(t,(t,e)=>{n.default.ShowLogOnce("正在解析CTM数据..."),this.m_parseTask.addBinaryData(new Uint8Array(t),e)},(t,e)=>{let s=Math.round(100*t);n.default.ShowLogOnce("ctm file loading "+s+"%")},(t,e)=>{this.ctmParseFinish({vertices:null,uvsList:null,normals:null,indices:null,uuid:e},e)})}}ctmParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.models=[t],r.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.CTMParserListerner=o},"74ee":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("698b"),i=s("7a08");var r;e.DataFormat=i.DataFormat,function(t){t[t["Geometry"]=0]="Geometry",t[t["Texture"]=1]="Texture",t[t["Undefined"]=2]="Undefined"}(r||(r={})),e.DataClass=r;class l{}l.lockStatus=0,e.DataUnitLock=l;class n{constructor(){if(this.m_dataPhaseFlag=a.DataPhaseFlag.PHASE_NONE,this.immediate=!1,this.lossTime=0,207!==l.lockStatus)throw Error("illegal operation !!!");this.m_uuid=n.s_uuid++,l.lockStatus=0}getUUID(){return this.m_uuid}clone(){return null}test(){}isNetPhase(){return a.DataPhaseFlag.isCpuPhase(this.m_dataPhaseFlag)}isCpuPhase(){return a.DataPhaseFlag.isCpuPhase(this.m_dataPhaseFlag)}isGpuPhase(){return a.DataPhaseFlag.isGpuPhase(this.m_dataPhaseFlag)}clearAllPhase(){this.m_dataPhaseFlag=a.DataPhaseFlag.clearAllPhase(this.m_dataPhaseFlag)}toNetPhase(){if(208!==l.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=a.DataPhaseFlag.addNetPhase(this.m_dataPhaseFlag)}toCpuPhase(){if(209!==l.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=a.DataPhaseFlag.addCpuPhase(this.m_dataPhaseFlag)}toGpuPhase(){if(210!==l.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=a.DataPhaseFlag.addGpuPhase(this.m_dataPhaseFlag)}}n.s_uuid=0,e.DataUnit=n},7566:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){this.m_dataList=[],this.m_waitingDataList=[],this.m_dataTotal=0,this.m_dataHaveTotal=0,this.m_startupFlag=0}sendDataTo(t){if(this.m_dataTotal>0){let e=null,s=this.m_waitingDataList.length;if(s>0&&(e=this.m_waitingDataList[0],t.sendDataTo(e),1==e.sendStatus))return this.m_dataTotal--,s--,this.m_waitingDataList.shift(),!0;if(s=this.m_dataTotal-s,s>0){if(e=this.m_dataList.shift(),t.sendDataTo(e),1==e.sendStatus)return this.m_dataTotal--,!0;this.m_waitingDataList.push(e)}}return!1}addData(t){t.sendStatus<0&&(t.sendStatus=0,this.m_dataTotal++,this.m_dataHaveTotal++,this.m_startupFlag=1,this.m_dataList.push(t))}getDataTotal(){return this.m_dataTotal}isEnabled(){return this.m_dataTotal*this.m_startupFlag>0}isStartup(){return this.m_startupFlag>0}}e.ThrDataPool=a},"7a08":function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["CTM"]="ctm",t["Draco"]="draco",t["OBJ"]="obj",t["FBX"]="fbx",t["GLB"]="glb",t["Jpg"]="jpg",t["Png"]="png",t["Gif"]="gif"}(a||(a={})),e.DataFormat=a},"7c58":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("3964");class i extends a.TaskDataRouter{constructor(t,e){super(t),this.m_triggerFlag=!0,this.m_wasmUrl=e}setData(t){this.m_wasmBinBuf=t.streams[0],this.m_dataEnabled=!0}acquireTrigger(){if(!this.isTransmission()&&this.m_triggerFlag){let t=new XMLHttpRequest;t.open("GET",this.m_wasmUrl,!0),t.responseType="arraybuffer",t.onload=()=>{this.m_wasmBinBuf=t.response,this.m_dataEnabled=!0},t.send(null),this.m_triggerFlag=!1}}getData(){return this.m_dataEnabled=!1,{info:"draco wasm code file",streams:[this.m_wasmBinBuf]}}getTransfers(){return[this.m_wasmBinBuf]}}e.DracoGeomParseTaskDataRouter=i},"7dbf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("83a3"),i=s("3b80"),r=s("1f9e");class l extends a.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new i.TaskJSFileDependency(t):this.dependency=new i.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam(r.CTMTaskCMD.PARSE,[t],{url:e})}addURL(t){""!=t&&this.addDataWithParam(r.CTMTaskCMD.LOAD_AND_PARSE,null,{url:t})}parseDone(t,e){if(null!=this.m_listener){let e=t.data;void 0==e.normals&&(e.normals=null),void 0==e.uvsList&&(e.uvsList=null),this.m_listener.ctmParseFinish(e,t.descriptor.url)}return!0}destroy(){super.destroy(),this.m_listener=null}}e.CTMParseTask=l},"7de1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a092"),i=s("2033");class r extends i.DataReceiverBase{constructor(){super(),r.s_total++}receiveDataUnit(t,e){let s=this.callback;this.callback=null,null!=s&&s(t,e)}}r.s_total=0;class l{constructor(){}reset(){this.receiver=null,this.unit=null}}class n{constructor(){this.m_receiverSchedule=null,this.m_unitPool=new a.DataUnitPool,this.m_taskModules=null,this.m_reqNodes=[]}createDataUnit(t,e,s=!1){return null}initTask(t,e,s,a){}setTaskModuleParams(t){null!=t&&(this.m_taskModules=t.slice(0))}isInitialized(){return null!=this.m_receiverSchedule}initialize(t,e,s=null){if(null==this.m_receiverSchedule&&null==this.m_threadSchedule){this.m_receiverSchedule=t,this.m_threadSchedule=e,this.initTask(this.m_unitPool,e,t,null!=this.m_taskModules?this.m_taskModules:s);let a=this.m_reqNodes;for(let t=0;t<a.length;t++){const e=a[t];this.m_unitPool.addUnit(e.unit.url,e.unit),this.m_receiverSchedule.addReceiver(e.receiver,e.unit)}}}hasDataUnit(t){return this.m_unitPool.hasUnitByUrl(t)}getCPUDataByUrlAndCallback(t,e,s,a=!1){let i=this.m_unitPool.getUnitByUrl(t);if(null!=i&&null!=s&&i.isCpuPhase())return i.lossTime=0,s(i,1),i;if(null==i){let l=new r;l.callback=s,i=this.getCPUDataByUrl(t,e,l,a)}return i}getCPUDataByUrl(t,e,s=null,a=!1){let i=this.m_unitPool.getUnitByUrl(t);if(null!=i&&null!=s&&i.isCpuPhase())return i.lossTime=0,s.receiveDataUnit(i,1),i;if(null==i&&(i=this.createDataUnit(t,e,a),i.lossTime=Date.now(),i.url=t,null!=this.m_receiverSchedule&&this.m_unitPool.addUnit(t,i)),null!=this.m_receiverSchedule)this.m_receiverSchedule.addReceiver(s,i);else{let t=new l;t.receiver=s,t.unit=i,this.m_reqNodes.push(t)}return i}getGPUDataByUrlAndCallback(t,e,s,a=!1){return null}getGPUDataByUrl(t,e,s=null,a=!1){return null}getGPUDataByUUIDAndCallback(t,e){return null}getGPUDataByUUID(t,e=null){return null}destroy(){null!=this.m_receiverSchedule&&(this.m_receiverSchedule=null,this.m_threadSchedule=null)}}e.ResourceSchedule=n},"7ebf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("1e86"),i=s("2356"),r=s("7566"),l=s("d2d9"),n=s("fce7"),o=s("60cd"),h=s("9d01");class d{constructor(t,e,s=""){this.m_uid=-1,this.m_worker=null,this.m_taskItems=[],this.m_free=!1,this.m_enabled=!1,this.m_initBoo=!0,this.m_thrData=null,this.m_commonModuleMap=new Map,this.autoSendData=!1,this.localDataPool=new r.ThrDataPool,this.globalDataPool=null,this.unlock=!0,this.m_tdrManager=t,this.m_taskPool=e,this.m_graphJsonStr=s,this.m_uid=d.s_uid++,this.m_taskfs=new Array(n.ThreadConfigure.MAX_TASKS_TOTAL),this.m_taskfs.fill(-1)}getUid(){return this.m_uid}isEnabled(){return this.m_enabled}isFree(){return this.m_free&&this.unlock}hasDataToThread(){return this.localDataPool.isEnabled()||this.globalDataPool.isEnabled()}sendPoolDataToThread(){if(this.m_free){let t=this.localDataPool.isEnabled();return t&&(t=this.localDataPool.sendDataTo(this)),t||(t=this.globalDataPool.sendDataTo(this)),t}return!1}sendDataTo(t){if(this.m_free&&this.m_taskfs[t.taskclass]>0){t.buildThis(!0);let e={streams:null};if(e.descriptor=t.descriptor,e.taskCmd=t.taskCmd,e.taskclass=t.taskclass,e.srcuid=t.srcuid,e.dataIndex=t.dataIndex,e.wfst=t.wfst,e.streams=t.streams,e.cmd=a.ThreadCMD.DATA_PARSE,e.threadIndex=this.m_uid,null!=t.streams){let s=t.streams,a=new Array(s.length);for(let t=0;t<s.length;++t)s[t]instanceof ArrayBuffer?a[t]=s[t]:a[t]=s[t].buffer;this.m_worker.postMessage(e,a)}else this.m_worker.postMessage(e);t.sendStatus=1,t.streams=null,e.descriptor=null,e.streams=null,this.m_thrData=t,this.m_free=!1}else{let e=this.m_taskfs[t.taskclass];if(0==e&&this.isFree()){let e=this.m_taskItems.length;for(let s=0;s<e;++s){const e=this.m_taskItems[s];if(e.info.taskClass==t.taskclass){this.initThreadTask(e),this.m_taskItems.splice(s,1);break}}}}}initModuleByTaskDescriptor(t){if(null!=t){let e=t.info.taskClass;e>=0&&e<this.m_taskfs.length&&this.m_taskfs[e]<0&&(this.m_taskfs[e]=0,this.m_taskItems.push(t))}}initModules(t){let e=[];for(let s=0;s<t.length;++s)this.m_commonModuleMap.has(t[s])||(this.m_commonModuleMap.set(t[s],1),e.push(t[s]));e.length>0&&this.m_worker.postMessage({cmd:a.ThreadCMD.INIT_COMMON_MODULE,threadIndex:this.getUid(),modules:e,type:l.ThreadCodeSrcType.JS_FILE_CODE})}initModuleByCodeString(t){this.m_worker.postMessage({cmd:a.ThreadCMD.INIT_COMMON_MODULE,threadIndex:this.getUid(),src:t,type:l.ThreadCodeSrcType.STRING_CODE})}initThreadTask(t){this.m_free=!1,this.m_enabled=!1,this.m_worker.postMessage({cmd:a.ThreadCMD.INIT_TASK,threadIndex:this.getUid(),param:t,info:t.info})}updateInitTask(){if(this.m_taskItems.length>0){let t=this.m_taskItems.pop();this.initThreadTask(t)}}receiveData(t){let e=t.wfst,s=h.ThreadWFST.GetTransStatus(e);this.m_free=s==h.TransST.None||s==h.TransST.Finish,this.autoSendData&&this.sendPoolDataToThread();let a=this.m_taskPool.getTaskByUid(t.srcuid),i=!0;null!=a&&(i=a.parseDone(t,0)),this.updateInitTask()}sendRouterDataTo(t){let e=t.param;null!=t&&t.isTransmission()&&e.threadIndex==this.m_uid&&(t.param=null,this.m_worker.postMessage({cmd:e.cmd,taskCmd:e.taskCmd,threadIndex:this.getUid(),taskclass:e.taskclass,data:t.getData()},t.getTransfers()))}terminate(){null!=this.m_worker&&(this.m_worker.terminate(),this.m_worker=null,this.m_free=!1,this.m_enabled=!1)}destroy(){null!=this.m_worker&&(this.terminate(),this.m_taskPool=null,this.m_tdrManager=null,this.m_graphJsonStr="",this.localDataPool=null,this.globalDataPool=null)}isDestroyed(){return null==this.m_taskPool}initialize(t){if(this.m_initBoo&&null!=t&&null==this.m_worker){this.m_initBoo=!1;let e=new Worker(URL.createObjectURL(t));this.m_worker=e,this.m_worker.onmessage=t=>{null!=this.m_thrData&&(i.ThreadSendData.Restore(this.m_thrData),this.m_thrData.sendStatus=-1,this.m_thrData=null);let s=t.data;switch(s.cmd){case a.ThreadCMD.DATA_PARSE:this.receiveData(s);break;case a.ThreadCMD.THREAD_INIT:e.postMessage({cmd:a.ThreadCMD.INIT_PARAM,threadIndex:this.getUid(),graphJsonStr:this.m_graphJsonStr,total:n.ThreadConfigure.MAX_TASKS_TOTAL});break;case a.ThreadCMD.INIT_TASK:if(this.m_taskfs[s.taskclass]<0)throw Error("sub worker taskclass and main worker logic taskClass are not equal !!!");this.m_taskfs[s.taskclass]=1,this.m_free=!0,this.m_enabled=!0,this.updateInitTask();break;case a.ThreadCMD.INIT_PARAM:this.m_free=!0,this.m_enabled=!0,this.updateInitTask();break;case a.ThreadCMD.THREAD_ACQUIRE_DATA:let t=new o.TDRParam(s.taskclass,s.cmd,s.taskCmd,this.getUid()),i=this.m_tdrManager.getRouterByTaskClass(s.taskclass);null!=i&&(i.acquireTrigger(),i.isDataEnabled()&&!i.isTransmission()?(i.param=t,this.sendRouterDataTo(i)):i=null),null==i&&this.m_tdrManager.waitRouterByParam(t);break;case a.ThreadCMD.THREAD_TRANSMIT_DATA:let r=this.m_tdrManager.getRouterByTaskClass(s.taskclass);null!=r&&(r.isDataEnabled(),r.setData(s.data));break;case a.ThreadCMD.INIT_COMMON_MODULE:break;default:break}}}}}d.s_uid=0,e.ThreadBase=d},"80fa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("83a3"),i=s("3b80"),r=s("8df7");e.PNGDescriptorType=r.PNGDescriptorType;class l extends a.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new i.TaskJSFileDependency(t):this.dependency=new i.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam("",[t],{url:e,width:0,height:0,filterType:4})}parseDone(t,e){return null!=this.m_listener&&this.m_listener.pngParseFinish(t.data,t.descriptor),!0}destroy(){super.destroy(),this.m_listener=null}}e.PNGParseTask=l},"83a3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("2356");class i{constructor(){this.m_uid=-1,this.m_globalDataPool=null,this.m_localDataPool=null,this.m_taskPool=null,this.m_info=null,this.m_parseIndex=0,this.m_parseTotal=0,this.dependency=null}attach(t){if(this.m_uid<0&&null==this.m_taskPool&&null!=t){this.m_taskPool=t;let e=t.attachTask(this);if(e>0)return this.m_uid=e,!0;throw Error("illegal operation!!!")}return!1}detach(){this.m_uid>0&&null!=this.m_taskPool&&(this.m_taskPool.detachTask(this),this.m_uid=-1)}setTaskInfo(t){this.m_info=t}setDataPool(t,e=null){this.m_globalDataPool=t,this.m_localDataPool=e}reset(){this.m_parseIndex=0}setParseTotal(t){this.m_parseTotal=t}isFinished(){return this.m_parseIndex>=this.m_parseTotal}getParsedTotal(){return this.m_parseIndex>=this.m_parseTotal?this.m_parseTotal:this.m_parseIndex+1}getParseTotal(){return this.m_parseTotal}getParsedIndex(){return this.m_parseIndex}getUid(){return this.m_uid}parseDone(t,e){throw Error("ThreadTask::parseDone(), Need Override it!")}createSendData(){let t=a.ThreadSendData.Create();return t.srcuid=this.getUid(),t.taskclass=this.m_info.taskClass,t.wfst=0,t}createSendDataWithParam(t,e=null,s=null){let i=a.ThreadSendData.Create();return i.srcuid=this.getUid(),i.taskclass=this.m_info.taskClass,i.taskCmd=t,i.streams=e,i.descriptor=null,i}addDataWithParam(t,e=null,s=null,a=!1){let i=this.createSendData();i.taskCmd=t,i.streams=e,i.descriptor=s,this.addData(i,a)}addData(t,e=!1){if(!(this.m_uid>=0))throw Error("Need attach this task !");t.srcuid=this.m_uid,t.taskclass=this.m_info.taskClass,e?null!=this.m_localDataPool&&this.m_localDataPool.addData(t):null!=this.m_globalDataPool&&this.m_globalDataPool.addData(t)}getWorkerSendDataAt(t){throw Error("ThreadTask::getWorkerSendDataAt(), Need Override !")}getTaskClass(){return this.m_info.taskClass}destroy(){this.detach(),this.m_info=null,this.m_globalDataPool=null,this.m_localDataPool=null,this.dependency=null}}e.ThreadTask=i},"85f5":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t){this.m_waitParams=[],this.m_enabledParams=[],this.m_threads=null,this.m_taskClassTotal=t>1024?t:1024,this.m_routers=new Array(t),this.m_routers.fill(null),this.m_rfs=new Array(t),this.m_rfs.fill(0)}setThreads(t){this.m_threads=t}hasRouterByTaskClass(t){return t>=0&&t<this.m_taskClassTotal&&null!=this.m_routers[t]}getRouterByTaskClass(t){if(t>=0&&t<this.m_taskClassTotal)return this.m_routers[t]}setRouter(t){let e=t.getTaskClass();if(!(e>=0&&e<this.m_taskClassTotal))throw Error("illegal object !!!");null==this.m_routers[e]&&(this.m_routers[e]=t)}waitRouterByParam(t){if(0!=t.status)throw Error("illegal param !!!");let e=t.taskclass;if(!(e>=0&&e<this.m_taskClassTotal))throw Error("illegal object !!!");this.m_waitParams.push(t),t.status=1}run(){let t=this.m_waitParams.length;if(t>0){let e=this.m_waitParams,s=null,a=null;for(let i=0;i<t;++i)a=e[i],s=this.m_routers[a.taskclass],null!=s&&s.isDataEnabled()&&!s.isTransmission()&&(s.acquireTrigger(),s.param=a,this.m_enabledParams.push(a),a.status=2,e.splice(i,1),--i,--t);if(t=this.m_enabledParams.length,t>0){e=this.m_enabledParams;let s=this.m_threads,a=s.length;for(let i=0;i<t;++i){const t=e[i];for(let e=0;e<a;++e){const a=s[e];a.getUid()==t.threadIndex&&a.sendRouterDataTo(this.getRouterByTaskClass(t.taskclass))}}this.m_enabledParams=[]}}}getEnabledParams(){if(this.m_enabledParams.length>0){let t=this.m_enabledParams;return this.m_enabledParams=[],t}return null}destroy(){this.m_taskClassTotal=0,this.m_routers.length=0}}e.TDRManager=a},8875:function(t,e,s){var a,i,r;(function(s,l){i=[],a=l,r="function"===typeof a?a.apply(e,i):a,void 0===r||(t.exports=r)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(c){var s,a,i,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,l=/@([^@]*):(\d+):(\d+)\s*$/gi,n=r.exec(c.stack)||l.exec(c.stack),o=n&&n[1]||!1,h=n&&n[2]||!1,d=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");o===d&&(s=document.documentElement.outerHTML,a=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),i=s.replace(a,"$1").trim());for(var m=0;m<u.length;m++){if("interactive"===u[m].readyState)return u[m];if(u[m].src===o)return u[m];if(o===d&&u[m].innerHTML&&u[m].innerHTML.trim()===i)return u[m]}return null}}return t}))},"8df7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"8eb0":function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["ctmParser"]="ctmGeomParser",t["objParser"]="objGeomParser",t["dracoParser"]="dracoGeomParser",t["pngParser"]="pngParser",t["fbxFastParser"]="fbxFastParser",t["threadCore"]="threadCore",t["coSpaceApp"]="coSpaceApp"}(a||(a={})),e.ModuleNS=a},"8f7d":function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("5b39"),r=s("aeff"),l=s("e12d"),n=a(s("3bda"));class o{constructor(){this.models=null,this.transforms=null}destroy(){this.models=null,this.transforms=null}}class h{constructor(t,e,s,a){this.m_parseTask=null,this.m_nodeMap=new Map,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new l.FBXParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new i.HttpFileLoader).load(t,(t,e)=>{n.default.ShowLogOnce("正在解析fbx数据..."),this.m_parseTask.addBinaryData(t,e)},(t,e)=>{let s=Math.round(100*t);n.default.ShowLogOnce("fbx file loading "+s+"%")},(t,e)=>{this.fbxParseFinish([{vertices:null,uvsList:null,normals:null,indices:null}],null,e,0,0)})}}fbxParseFinish(t,e,s,a,i){if(this.m_unitPool.hasUnitByUrl(s)){let l=this.m_unitPool.getUnitByUrl(s),n=this.m_nodeMap;if(n.has(s)){let a=n.get(s);for(let s=0;s<t.length;++s)a.models.push(t[s]),a.transforms.push(e)}else{let a=new o;a.models=t,a.transforms=[e],n.set(s,a)}if(null!=l.data.modelReceiver&&l.data.modelReceiver(t,[e],a,i),a+1<i)return;if(null!=l){let t=n.get(s);l.lossTime=Date.now()-l.lossTime,l.data.dataFormat=r.DataFormat.FBX,l.data.models=t.models,l.data.transforms=t.transforms,t.destroy(),n.delete(s),r.DataUnitLock.lockStatus=209,l.toCpuPhase(),l.immediate&&this.m_receiverSchedule.testUnit(l)}}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.FBXParserListerner=h},"9cc2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("3844");e.ListPoolItem=a.ListPoolItem;class i{constructor(){this.m_list=[null],this.m_total=1,this.m_freeUUIDs=[]}hasItemByUUID(t){return t>0&&t<this.m_total&&this.m_list[t],!1}hasItem(t){return null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&this.m_list[t.listUUID],!1}hasnotItem(t){return null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&this.m_list[t.listUUID],!0}getItemByUUID(t){return t>0&&t<this.m_total&&this.m_list[t],null}addItem(t){if(null!=t){if(0!=t.listUUID)throw Error("ListPool::addItem() is the illegal operation !!!");if(this.m_freeUUIDs.length>0){if(t.listUUID=this.m_freeUUIDs.pop(),null!=this.m_list[t.listUUID])throw Error("ListPool::addItem() is the illegal operation !!!");this.m_list[t.listUUID]=t}else t.listUUID=this.m_total,this.m_total++,this.m_list.push(t)}}removeItem(t){if(null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&null!=this.m_list[t.listUUID]){if(this.m_list[t.listUUID]!=t)throw"ListPool::removeItem() is the illegal operation !!!";this.m_freeUUIDs.push(t.listUUID),this.m_list[t.listUUID]=null,t.listUUID=0}}}e.ListPool=i},"9d01":function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["None"]=0]="None",t[t["Running"]=20]="Running",t[t["Finish"]=21]="Finish"}(a||(a={})),e.TransST=a;class i{static Build(t,e,s,a){return(t<<24)+(e<<16)+(s<<8)+a}static ModifyTransStatus(t,e){return t&=4294967040,t+e}static GetTransStatus(t){return t&=255,t}}e.ThreadWFST=i},a00a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("cbd5"),i=s("7a08");class r{constructor(){this.m_uid=r.s_uid++,this.dataFormat=i.DataFormat.CTM,this.callback=null,this.url=""}getUid(){return this.m_uid}reset(){this.callback=null}}r.s_uid=0;class l{constructor(){this.m_withCredentials=!1,this.m_loadingTotal=0,this.m_cpuReqNodes=[],this.cospace=new a.CoSpace,this.netLoadingMaxCount=8,this.m_timeoutId=-1,this.m_updating=!1}setThreadDependencyGraphJsonString(t){this.cospace.setThreadDependencyGraphJsonString(t)}setTaskModuleParams(t){this.cospace.setTaskModuleParams(t)}initialize(t,e,s=!0){this.cospace.initialize(t,e,s)}testCPUReqNode(){let t=this.m_cpuReqNodes.length;if(t>0){this.netLoadingMaxCount<t&&(t=this.netLoadingMaxCount);for(let e=0;e<t;++e){if(!(this.m_loadingTotal<=this.netLoadingMaxCount))break;{const t=this.m_cpuReqNodes.shift(),e=t.url,s=t.dataFormat,a=t.callback;t.reset(),this.getCPUDataByUrlAndCallback(e,s,a)}}}}cpuLoadTest(){this.m_timeoutId,this.m_timeoutId>-1&&(clearTimeout(this.m_timeoutId),this.m_timeoutId=-1),this.m_cpuReqNodes.length>0?(this.testCPUReqNode(),this.m_timeoutId=setTimeout(this.cpuLoadTest.bind(this),25)):this.m_updating=!1}getCPUDataByUrlAndCallback(t,e,s,a=!1){let i=s;if(this.m_loadingTotal>this.netLoadingMaxCount){const a=new r;return a.url=t,a.dataFormat=e,a.callback=s,this.m_cpuReqNodes.push(a),this.m_updating||(this.m_updating=!0,this.cpuLoadTest()),null}return i=(t,e)=>{this.m_loadingTotal--,s(t,e)},this.m_loadingTotal++,this.getCPUDataByUrlAndCallback2(t,e,i,a)}getCPUDataByUrlAndCallback2(t,e,s,a=!1){let r=null;switch(e){case i.DataFormat.CTM:case i.DataFormat.OBJ:case i.DataFormat.Draco:case i.DataFormat.FBX:case i.DataFormat.GLB:r=this.cospace.geometry;break;case i.DataFormat.Jpg:case i.DataFormat.Png:case i.DataFormat.Gif:r=this.cospace.texture;break;default:break}return null!=r?r.getCPUDataByUrlAndCallback(t,e,s,a):null}destroy(){}}function n(){return new l}e.Instance=l,e.createInstance=n},a054:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("58fc");e.GeometryModelDataType=a.GeometryModelDataType},a092:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee"),i=s("aeff");class r{constructor(){}}class l{constructor(){this.m_urlPool=new Map,this.m_idPool=new Map,l.s_inited&&(l.s_inited=!1,this.createUnit())}createUnit(){a.DataUnitLock.lockStatus=207;let t=new a.DataUnit;return t}createGeometryUnit(){a.DataUnitLock.lockStatus=207;let t=new i.GeometryDataUnit;return t}hasUnitByUrl(t){return this.m_urlPool.has(t)}hasUnitByUUID(t){return this.m_idPool.has(t)}addUnit(t,e){if(""!=t&&null!=e&&!this.m_urlPool.has(t)){let s=new r;s.uuid=e.getUUID(),s.url=t,s.unit=e,this.m_urlPool.set(t,s),this.m_idPool.set(e.getUUID(),s)}}removeUnit(t){if(null!=t&&this.m_idPool.has(t.getUUID())){let e=this.m_idPool.get(t.getUUID());this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}removeUnitByUUID(t){if(this.m_idPool.has(t)){let e=this.m_idPool.get(t);this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}removeUnitByUrl(t){if(this.m_urlPool.has(t)){let e=this.m_urlPool.get(t);this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}getUnitByUrl(t){let e=this.m_urlPool.get(t);return null!=e?e.unit:null}getUnitByUUID(t){let e=this.m_idPool.get(t);return null!=e?e.unit:null}}l.s_inited=!0,e.DataUnitPool=l},a567:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{static uint24RGBToCSSHeXRGBColor(t){let e=Math.round(t).toString(16);if(e.length>6)e=e.slice(-6);else if(e.length<6){let t=6-e.length;const s="000000";e=s.slice(0,t)+e}return"#"+e}}e.RGBColorUtil=a},aeff:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee");e.DataFormat=a.DataFormat,e.DataUnitLock=a.DataUnitLock,e.DataUnit=a.DataUnit;const i=s("58fc");e.GeometryModelDataType=i.GeometryModelDataType;class r{constructor(){this.dataFormat=a.DataFormat.CTM,this.models=null,this.transforms=null,this.modelReceiver=null}setFormatBUrl(t){}destroy(){this.modelReceiver=null,this.models=null}}e.GeometryDataContainer=r;class l extends a.DataUnit{constructor(){super(),this.data=null,this.dataClass=a.DataClass.Geometry}}e.GeometryDataUnit=l},b2a0:function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("5b39"),r=s("bd49"),l=a(s("3bda")),n=s("80fa");class o{constructor(t,e,s,a){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new n.PNGParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new i.HttpFileLoader).load(t,(t,e)=>{l.default.ShowLogOnce("正在解析png数据..."),this.m_parseTask.addBinaryData(new Uint8Array(t),e)},(t,e)=>{let s=Math.round(100*t);l.default.ShowLogOnce("obj file loading "+s+"%")},(t,e)=>{this.pngParseFinish(null,{url:e,width:0,height:0,filterType:0})})}}pngParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e.url)){let s=this.m_unitPool.getUnitByUrl(e.url);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.dataFormat=r.DataFormat.Png,s.data.desList=[e],s.data.imageDatas=[t],r.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.PNGParserListerner=o},b406:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){}initialize(){}addModuleByUniqueName(t){}startupModuleByUniqueName(t){}destroy(){}}e.CoRuntime=a},bd49:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee");e.DataFormat=a.DataFormat,e.DataUnitLock=a.DataUnitLock,e.DataUnit=a.DataUnit;class i{constructor(){this.dataFormat=a.DataFormat.Png,this.desList=null,this.images=null,this.imageDatas=null}setFormatBUrl(t){}}e.TextureDataContainer=i;class r extends a.DataUnit{constructor(){super(),this.data=null,this.dataClass=a.DataClass.Texture}}e.TextureDataUnit=r},c917:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t,e,s){this.info=null,this.inited=!1,this.type=t,this.src=e,this.moduleName=s}}e.TaskDescriptor=a},cbd5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("3a1d"),i=s("2a59"),r=s("2931"),l=s("eda7"),n=s("1173"),o=s("b406");class h{constructor(){this.m_initing=!0,this.m_receiver=new r.ReceiverSchedule,this.system=new n.CoSystem,this.runtime=new o.CoRuntime,this.thread=new a.ThreadSchedule,this.geometry=new i.GeometryResourceSchedule,this.texture=new l.TextureResourceSchedule,this.m_timeoutId=-1}setThreadDependencyGraphJsonString(t){this.thread.setDependencyGraphJsonString(t)}setTaskModuleParams(t){null!=t&&(this.geometry.setTaskModuleParams(t),this.texture.setTaskModuleParams(t))}isInitialized(){return!this.m_initing}initialize(t,e,s=!1,a=3e3){this.m_initing&&(this.m_initing=!1,this.thread.setParams(s,a),this.thread.initialize(t,e),this.geometry.initialize(this.m_receiver,this.thread,null),this.texture.initialize(this.m_receiver,this.thread,null),this.update())}update(){let t=40;this.thread.isSupported()&&(this.thread.hasTaskData()||this.m_receiver.getReceiversTotal()>0)&&(t=20),this.thread.run(),this.m_receiver.run(),this.m_timeoutId>-1&&clearTimeout(this.m_timeoutId),this.m_timeoutId=setTimeout(this.update.bind(this),t)}destroy(){}}e.CoSpace=h},ceac:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a054");e.OBJModelDataType=a.OBJModelDataType;const i=s("83a3"),r=s("3b80");class l extends i.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new r.TaskJSFileDependency(t):this.dependency=new r.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam("",[t],{url:e})}addURL(t){if(""!=t)throw Error("illegal operation!!!")}parseDone(t,e){if(null!=this.m_listener){let e=t.data;this.m_listener.objParseFinish(e.models,t.descriptor.url)}return!0}destroy(){super.destroy(),this.m_listener=null}}e.OBJParseTask=l},d2d9:function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["STRING_CODE"]=0]="STRING_CODE",t[t["BLOB_CODE"]=1]="BLOB_CODE",t[t["JS_FILE_CODE"]=2]="JS_FILE_CODE",t[t["DEPENDENCY"]=3]="DEPENDENCY"}(a||(a={})),e.ThreadCodeSrcType=a},d9d1:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("dba0"),i=s("7c58");class r{constructor(t,e=2){this.m_inited=!0,this.m_thrSchedule=null,this.m_meshBuf=null,this.m_listener=null,this.m_dracoTask=null,this.m_wasmUrl="",this.m_segRangeList=null,this.m_taskModuleUrl=t,this.m_dracoWasmVersion=e}setListener(t){this.m_listener=t,null!=this.m_dracoTask&&this.m_dracoTask.setListener(t)}initialize(t,e="static/cospace/modules/dracoLib/"){if(this.m_inited){this.m_inited=!1,this.m_thrSchedule=t;let s="d2.md",a="w2.js";switch(this.m_dracoWasmVersion){case 1:s="d1.md",a="w1.js";break;case 3:s="d3.md",a="w3.js";break;default:break}this.buildTask(e+a,e+s)}}parseBinaryData(t,e=null){null!=t&&(null==e||e.length<2?this.m_segRangeList=[-1,-1]:this.m_segRangeList=e.slice(0),this.m_meshBuf=t,null!=this.m_dracoTask&&(this.m_dracoTask.isFinished(),this.m_dracoTask.reset(),this.m_dracoTask.setParseSrcData(this.m_meshBuf,this.m_segRangeList)))}parseSingleSegData(t,e,s=0){null!=t&&this.m_dracoTask.setSingleSegData(t,e,s)}load(t,e=null){null==e||e.length<2?this.m_segRangeList=[-1,-1]:this.m_segRangeList=e.slice(0),null!=this.m_dracoTask&&(this.m_dracoTask.isFinished(),this.m_dracoTask.reset()),this.loadDracoFile(t)}loadDracoFile(t){const e=new FileReader;e.onload=t=>{this.m_meshBuf=e.result,this.m_dracoTask.setParseSrcData(this.m_meshBuf,this.m_segRangeList)};const s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=()=>{e.readAsArrayBuffer(s.response)},s.send(null)}buildTask(t,e){this.m_wasmUrl=e;let s=this.m_thrSchedule;if(null!=s&&(this.m_dracoTask=new a.DracoGeomParseTask("dracoGeomParser",s),this.m_dracoTask.setListener(this.m_listener),s.bindTask(this.m_dracoTask),!s.hasRouterByTaskClass(this.m_dracoTask.getTaskClass()))){let t=new i.DracoGeomParseTaskDataRouter(this.m_dracoTask.getTaskClass(),e);s.setTaskDataRouter(t)}}destroy(){null!=this.m_dracoTask&&(this.m_dracoTask.destroy(),this.m_dracoTask=null),this.m_meshBuf=null,this.m_listener=null,this.m_thrSchedule=null}}e.DracoGeomBuilder=r},dba0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("3b80"),i=s("83a3"),r=s("2e55");class l extends i.ThreadTask{constructor(t,e){super(),this.m_enabled=!0,this.m_listener=null,this.m_models=[],this.m_srcBuf=null,this.m_segs=null,this.m_segIndex=0,this.m_single=!1,t.indexOf("/")>0?this.dependency=new a.TaskJSFileDependency(t):this.dependency=new a.TaskUniqueNameDependency(t),this.m_thrScheDule=e}setListener(t){this.m_listener=t}reset(){super.reset(),this.m_models=[],this.m_segIndex=0,this.m_segs=null,this.m_enabled=!0}setSingleSegData(t,e,s=0){null!=t&&(this.m_single=!0,this.addDataWithParam(r.DracoTaskCMD.PARSE,[new Uint8Array(t)],{beginI:0,endI:t.byteLength,status:0,url:e,index:s}))}parseData(t,e,s){null!=t&&(this.m_enabled=!1,this.addDataWithParam(r.DracoTaskCMD.PARSE,[new Uint8Array(t)],{beginI:e,endI:s,status:0}))}parseNextSeg(){if(this.m_enabled&&null!=this.m_segs&&this.m_segIndex<this.m_segs.length){let t=this.m_thrScheDule.getMaxThreadsTotal()>0?this.m_thrScheDule.getMaxThreadsTotal():1;for(let e=0;e<t;e++){if(!(this.m_segIndex<this.m_segs.length))break;{let t=this.m_segs[this.m_segIndex],e=this.m_segs[this.m_segIndex+1];t<0&&(t=0),(e<8||e>this.m_srcBuf.byteLength)&&(e=this.m_srcBuf.byteLength);let s=this.m_srcBuf.slice(t,e);this.parseData(s,0,s.byteLength),this.m_segIndex+=2}}}}setParseSrcData(t,e){null!=t&&null!=e&&null==this.m_segs&&(this.m_single=!1,this.m_segIndex=0,this.m_srcBuf=t,this.m_segs=e,this.setParseTotal(e.length/2),this.parseNextSeg())}parseDone(t,e){switch(t.taskCmd){case r.DracoTaskCMD.PARSE:this.m_enabled=!0;let e=t.data.model;if(void 0==e.normals&&(e.normals=null),void 0==e.uvsList&&(e.uvsList=null),this.m_single){let s=t.descriptor;this.m_listener.dracoParseSingle(e,s.url,s.index)}else this.m_parseIndex++,this.m_models.push(e),null!=this.m_listener&&(this.isFinished()?this.m_listener.dracoParseFinish(this.m_models,this.getParseTotal()):(this.parseNextSeg(),this.m_listener.dracoParse(e,this.getParsedIndex(),this.getParseTotal())));break;default:break}return!0}destroy(){super.destroy(),this.m_listener=null,this.m_srcBuf=null,this.m_models=[],this.m_segIndex=0,this.m_segs=null}}e.DracoGeomParseTask=l},e12d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("58fc");e.GeometryModelDataType=a.GeometryModelDataType;const i=s("83a3"),r=s("3b80");class l extends i.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new r.TaskJSFileDependency(t):this.dependency=new r.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam("",[t],{url:e})}addURL(t){if(""!=t)throw Error("illegal operation!!!")}parseDone(t,e){if(null!=this.m_listener){let e=t.data;this.m_listener.fbxParseFinish(e.models,e.transform,t.descriptor.url,e.index,e.total)}return!0}destroy(){super.destroy(),this.m_listener=null}}e.FBXParseTask=l},eda7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee"),i=s("7de1"),r=s("bd49"),l=s("b2a0"),n=s("8eb0");class o extends i.ResourceSchedule{constructor(){super(),this.m_waitingUnits=[]}addUrlToTask(t){let e=t.url;switch(t.data.dataFormat){case a.DataFormat.Jpg:break;case a.DataFormat.Png:this.m_pngListener.addUrlToTask(e);break;default:break}}createDataUnit(t,e,s=!1){r.DataUnitLock.lockStatus=207;let a=new r.TextureDataUnit;return a.lossTime=Date.now(),a.immediate=s,a.data=new r.TextureDataContainer,a.data.dataFormat=e,a.url=t,this.isInitialized()?this.addUrlToTask(a):this.m_waitingUnits.push(a),a}initTask(t,e,s,a){for(let r=0;r<a.length;++r){const i=a[r];switch(i.name){case n.ModuleNS.pngParser:this.m_pngListener=new l.PNGParserListerner(t,e,i,s);break;default:break}}let i=this.m_waitingUnits;for(let r=0;r<i.length;r++)this.addUrlToTask(i[r]);this.m_waitingUnits=[]}destroy(){super.destroy(),this.m_waitingUnits=[],null!=this.m_pngListener&&(this.m_pngListener.destroy(),this.m_pngListener=null)}}e.TextureResourceSchedule=o},eed9:function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("5b39"),r=s("aeff"),l=a(s("3bda")),n=s("d9d1");class o{constructor(t,e,s,a){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_dirUrl=s.params[0],this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new n.DracoGeomBuilder(this.m_moduleUrl);t.initialize(this.m_threadSchedule,this.m_dirUrl),t.setListener(this),this.m_parseTask=t}(new i.HttpFileLoader).load(t,(t,e)=>{l.default.ShowLogOnce("正在解析Draco数据..."),this.m_parseTask.parseSingleSegData(t,e)},(t,e)=>{let s=Math.round(100*t);l.default.ShowLogOnce("draco file loading "+s+"%")},(t,e)=>{this.dracoParseSingle({vertices:null,uvsList:null,normals:null,indices:null},e,0)})}}dracoParseSingle(t,e,s){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.models=[t],r.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}dracoParse(t,e,s){}dracoParseFinish(t,e){}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.DracoParserListerner=o},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var a=s("a00a");for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i)},fce7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.MAX_TASKS_TOTAL=1024,e.ThreadConfigure=a}})}));